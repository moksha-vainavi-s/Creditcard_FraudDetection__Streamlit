# -*- coding: utf-8 -*-
"""MOKSHA VAINAVI S_Credit Card Fraudlent Transaction Dataset

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tjuuoBtsKQq9N2KAVOPYgDiOPWSV_HZ9
"""

import pandas as pd
import numpy as np

df=pd.read_csv('/content/Final Transactions.csv')
df

df.head()

df.tail()

df.info()

df.isnull().sum()

df.dtypes

df.shape

df.describe()

df.columns

df.duplicated().sum()

if 'Unnamed: 0' in df.columns:
    df.drop(columns=['Unnamed: 0'], inplace=True)

df

df.dropna(inplace=True)
df.isnull().sum()

import matplotlib.pyplot as plt
import seaborn as sns

#Count Plot
plt.figure(figsize=(6, 4))
sns.countplot(data=df, x='TX_FRAUD', palette='Set2')
plt.title("Count of Fraudulent Transactions")
plt.xlabel("Fraudulent")
plt.ylabel("Count")
plt.show()

# Pairplot
df_sample = df.sample(n=500, random_state=42)
sns.pairplot(df_sample, hue='TX_FRAUD', palette='Set1')
plt.suptitle("Pairplot of Fraudulent Transactions", y=1.02)
plt.show()

#Correlation Heatmap
plt.figure(figsize=(8, 6))
sns.heatmap(df.drop('TX_DATETIME', axis=1).corr(), annot=True, cmap='coolwarm', fmt=".2f")
plt.title("Correlation Heatmap")
plt.show()

#Boxplot
plt.figure(figsize=(8, 6))
sns.boxplot(x='TX_FRAUD', y='TX_AMOUNT', data=df)
plt.title("Transaction Amount by Fraud Status")
plt.show()

from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression

X = df[['TX_FRAUD_SCENARIO']]
y = df['TX_FRAUD']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

model = LogisticRegression()

model.fit(X_train, y_train)

# Separate fraud & non-fraud for plotting
fraud = X_train[y_train == 1]
non_fraud = X_train[y_train == 0]

y_pred=model.predict(X_test)
print(y_pred)

# Scatter Plot
plt.figure(figsize=(8,6))
plt.scatter(non_fraud, [0]*len(non_fraud), color='blue', alpha=0.6, label='Non-Fraud')
plt.scatter(fraud, [1]*len(fraud), color='red', alpha=0.6, label='Fraud')

# Generate smooth S-curve
X_curve = np.linspace(df['TX_FRAUD_SCENARIO'].min(), df['TX_FRAUD_SCENARIO'].max(), 300).reshape(-1, 1)
y_curve_prob = model.predict_proba(X_curve)[:, 1]

# Plot logistic regression curve
plt.plot(X_curve, y_curve_prob, color='green', linewidth=2, label='Logistic Curve')

plt.xlabel("Fraud Scenario")
plt.ylabel("Fraud Probability")
plt.title("Fraud Scenario vs Fraud Probability (Logistic Regression)")
plt.legend()
plt.show()

from sklearn.metrics import mean_squared_error, r2_score

r2= r2_score(y_test, y_pred)
mse= mean_squared_error(y_test, y_pred)
rmse= np.sqrt(mse)

r2= r2_score(y_test, y_pred)
print(f"R-squared: {r2:.4f}")
print(f"Mean Squared Error: {mse:.4f}")
print(f"Root Mean Squared Error: {rmse:.4f}")

import joblib
joblib.dump(model, "creditcardmodel.pkl")
model= joblib.load('creditcardmodel.pkl')
prediction = model.predict(X_test)